<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>reduxjs/toolkit https://github.com/reduxjs/redux-toolkit | tangdw</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.jpg">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="">
    <meta name="theme-color" content="#f22148">
    
    <link rel="preload" href="/assets/css/0.styles.3f503044.css" as="style"><link rel="preload" href="/assets/js/app.da05fdbf.js" as="script"><link rel="preload" href="/assets/js/2.208295da.js" as="script"><link rel="preload" href="/assets/js/25.eda3379a.js" as="script"><link rel="preload" href="/assets/js/5.b3cdef39.js" as="script"><link rel="prefetch" href="/assets/js/10.874c21b1.js"><link rel="prefetch" href="/assets/js/11.06584f03.js"><link rel="prefetch" href="/assets/js/12.a5c8c05f.js"><link rel="prefetch" href="/assets/js/13.1b507851.js"><link rel="prefetch" href="/assets/js/14.c27a0ed9.js"><link rel="prefetch" href="/assets/js/15.fae66cfd.js"><link rel="prefetch" href="/assets/js/16.8b83fc5b.js"><link rel="prefetch" href="/assets/js/17.eafc6cc3.js"><link rel="prefetch" href="/assets/js/18.f7675d14.js"><link rel="prefetch" href="/assets/js/19.aa19b35f.js"><link rel="prefetch" href="/assets/js/20.af217273.js"><link rel="prefetch" href="/assets/js/21.8ddc378c.js"><link rel="prefetch" href="/assets/js/22.36e77ad8.js"><link rel="prefetch" href="/assets/js/23.5a61c462.js"><link rel="prefetch" href="/assets/js/24.582c1b00.js"><link rel="prefetch" href="/assets/js/26.8e4cbbe9.js"><link rel="prefetch" href="/assets/js/27.03cb3422.js"><link rel="prefetch" href="/assets/js/28.645ce61e.js"><link rel="prefetch" href="/assets/js/29.f897465a.js"><link rel="prefetch" href="/assets/js/3.967895da.js"><link rel="prefetch" href="/assets/js/30.d2934177.js"><link rel="prefetch" href="/assets/js/31.42258174.js"><link rel="prefetch" href="/assets/js/32.f7b5e341.js"><link rel="prefetch" href="/assets/js/33.362b0b71.js"><link rel="prefetch" href="/assets/js/34.91512baa.js"><link rel="prefetch" href="/assets/js/35.e51fc052.js"><link rel="prefetch" href="/assets/js/36.41c20116.js"><link rel="prefetch" href="/assets/js/37.e90f6066.js"><link rel="prefetch" href="/assets/js/38.3878636b.js"><link rel="prefetch" href="/assets/js/39.f310c7d2.js"><link rel="prefetch" href="/assets/js/4.9f3812bd.js"><link rel="prefetch" href="/assets/js/40.c1e2ee49.js"><link rel="prefetch" href="/assets/js/41.cf733c7c.js"><link rel="prefetch" href="/assets/js/42.ef868d9d.js"><link rel="prefetch" href="/assets/js/43.8478bfa6.js"><link rel="prefetch" href="/assets/js/44.dd9a1d85.js"><link rel="prefetch" href="/assets/js/45.d014f7a8.js"><link rel="prefetch" href="/assets/js/46.205be7a4.js"><link rel="prefetch" href="/assets/js/47.a942e446.js"><link rel="prefetch" href="/assets/js/48.f11dc1c7.js"><link rel="prefetch" href="/assets/js/49.30f1d0d9.js"><link rel="prefetch" href="/assets/js/50.ad3da487.js"><link rel="prefetch" href="/assets/js/51.6685e327.js"><link rel="prefetch" href="/assets/js/52.6f6c68f4.js"><link rel="prefetch" href="/assets/js/53.4acba881.js"><link rel="prefetch" href="/assets/js/54.609dd144.js"><link rel="prefetch" href="/assets/js/6.b8f3f640.js"><link rel="prefetch" href="/assets/js/7.2e8acf8c.js"><link rel="prefetch" href="/assets/js/8.cd73e5c7.js"><link rel="prefetch" href="/assets/js/9.ba0911e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3f503044.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">tangdw</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/书签.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/shell.html" class="nav-link">
  Shell
</a></div><div class="nav-item"><a href="/nestjs.html" class="nav-link">
  Nestjs
</a></div><div class="nav-item"><a href="/golang.html" class="nav-link">
  golang
</a></div><div class="nav-item"><a href="/life/传习录.html" class="nav-link">
  My Life
</a></div> <a href="https://github.com/tangdw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/书签.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/shell.html" class="nav-link">
  Shell
</a></div><div class="nav-item"><a href="/nestjs.html" class="nav-link">
  Nestjs
</a></div><div class="nav-item"><a href="/golang.html" class="nav-link">
  golang
</a></div><div class="nav-item"><a href="/life/传习录.html" class="nav-link">
  My Life
</a></div> <a href="https://github.com/tangdw" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/书签.html" class="sidebar-link">我的书签</a></li><li><a href="/blog/刷面试题.html" class="sidebar-link">面试复习</a></li><li><a href="/blog/《算法图解》笔记.html" class="sidebar-link">《算法图解》笔记</a></li><li><a href="/blog/React 扫盲.html" class="sidebar-link">React 扫盲</a></li><li><a href="/blog/Mobx 扫盲.html" class="sidebar-link">Mobx 扫盲</a></li><li><a href="/blog/Typescript 扫盲.html" class="sidebar-link">Typescript 扫盲</a></li><li><a href="/blog/RxJS 笔记.html" class="sidebar-link">《深入浅出 RxJS》笔记</a></li><li><a href="/blog/PWA.html" class="sidebar-link">PWA 相关知识点</a></li><li><a href="/blog/性能优化.html" class="sidebar-link">性能方面</a></li><li><a href="/blog/各种小技巧.html" class="sidebar-link">各种小技巧</a></li><li><a href="/blog/eslint + prettier.html" class="sidebar-link">eslint + pretier</a></li><li><a href="/blog/antd 树形 table 组件.html" class="sidebar-link">antd 树形 table 实现父子联动选择</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="reduxjs-toolkit-https-github-com-reduxjs-redux-toolkit"><a href="#reduxjs-toolkit-https-github-com-reduxjs-redux-toolkit" aria-hidden="true" class="header-anchor">#</a> reduxjs/toolkit https://github.com/reduxjs/redux-toolkit</h2> <p>https://www.npmtrends.com/@rematch/core-vs-@reduxjs/toolkit-vs-dva</p> <p>其中 dva、rematch、reduxjs/toolkit 是同一类的，都是基于 redux 封装的库，发布时间由早到晚。reduxjs/toolkit 发布最晚，有借鉴前两个的一些思路，ts 类型支持是最好的，这三个就选 reduxjs/toolkit，以下简称 RTK</p> <p>yarn add @reduxjs/toolkit react-redux @types/react-redux</p> <p>通常对于一个大型应用，需要将全局状态进行拆分模块，在 RTK 里叫 &quot;切片&quot; slice，通过 combineReducers 将多个 slice 的 reducer 进行合并</p> <p>src/index.tsx</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'src/store/index.ts'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token punctuation">;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>src / store / index.ts</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore<span class="token punctuation">,</span> combineReducers<span class="token punctuation">,</span> Action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ThunkAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>

<span class="token keyword">import</span> dolphins <span class="token keyword">from</span> <span class="token string">'./dolphins'</span>
<span class="token keyword">import</span> sharks <span class="token keyword">from</span> <span class="token string">'./sharks'</span>

<span class="token comment">// 由多个 reducer 合并的根 reducer</span>
<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  dolphins<span class="token punctuation">,</span>
  sharks<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token punctuation">:</span> rootReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 获取全局 state 的类型，在 FC 组件里 useSelector 时会用到，在 class 组件里 mapState 时会用到</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> RootState <span class="token operator">=</span> ReturnType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeof</span> <span class="token attr-name">store.getState</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

// 获取 dispatch 类型，useDispatch 会用到
export type AppDispatch = typeof store.dispatch

// 使用异步 action 会用到，RTK 默认集成了 redux-thunk
export type RootThunk = ThunkAction&lt;void, RootState, null, Action</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">&gt;

// 导出封装 useAppDispatch （有类型提示）
export const useAppDispatch = () =&gt; useDispatch</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppDispatch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">()

export default store
</span></code></pre></div><p>使用 createSlice 创建 切片</p> <p>src/store/sharks.ts</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createAsyncThunk<span class="token punctuation">,</span> createSlice<span class="token punctuation">,</span> PayloadAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/utils'</span>

<span class="token comment">// 异步 action: 使用 createAsyncThunk 创建异步 actionCreater，返回值有三个属性，对应异步的三种状态：{ pending, fulfilled, rejected }</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> incrementAsync <span class="token operator">=</span> <span class="token function">createAsyncThunk</span><span class="token punctuation">(</span><span class="token string">'async/+num'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> num
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用 createSlice 创建切片（可以看作是对全局 state 的拆分）</span>
<span class="token keyword">const</span> sharks <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'sharks'</span><span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 根据 reducers 的 key 自动生成 action</span>
  reducers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 都是同步操作,ts 里需指定 payload 的类型</span>
    <span class="token function">increment</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">:</span> PayloadAction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">) </span><span class="token punctuation">{</span>
      state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span><span class="token plain-text">,
  },
  // 用来订阅独立的/外部的 action，有两种写法
  extraReducers: </span><span class="token punctuation">{</span>
    <span class="token comment">// 对象形式的 extraReducers 的 key 是一个 string，无法感知 actionCreater 里 action 的类型，需要再次手动指定</span>
    <span class="token comment">// 订阅异步请求的成功状态（fulfilled）</span>
    <span class="token punctuation">[</span>incrementAsync<span class="token punctuation">.</span>fulfilled<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">:</span> PayloadAction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">) =&gt; </span><span class="token punctuation">{</span>
      state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span><span class="token plain-text">,
  },
})

export const </span><span class="token punctuation">{</span> increment <span class="token punctuation">}</span><span class="token plain-text"> = sharks.actions

export default sharks.reducer
</span></code></pre></div><p>src/store/dolphins.ts</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice<span class="token punctuation">,</span> PayloadAction<span class="token punctuation">,</span> current <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/utils'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> sharks <span class="token keyword">from</span> <span class="token string">'./sharks'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootThunk <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'.'</span>

<span class="token keyword">const</span> dolphins <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'dolphins'</span><span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">:</span> PayloadAction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">) </span><span class="token punctuation">{</span>
      <span class="token comment">// reducer 里默认引入了 immer，这里的 state 实际是一个副本，current 是重 immer 里直接导出的方法，用来拿到对象的值而不是 Proxy</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`TTT: state`</span></span><span class="token punctuation">,</span> <span class="token function">current</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
      state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span><span class="token plain-text">,
  },
  // 第二种写法，在 ts 里能自动推导出 action 的类型
  extraReducers: (builder) =&gt; </span><span class="token punctuation">{</span>
    <span class="token comment">// 添加 reducer，订阅独立的/外部的 actions</span>
    builder<span class="token punctuation">.</span><span class="token function">addCase</span><span class="token punctuation">(</span>sharks<span class="token punctuation">.</span>increment<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token builtin">number</span> <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// builder 里有三种方法 addCase addMatcher addDefault</span>
    <span class="token comment">// addMatcher 可用于匹配多个 action，来进行一些统一处理</span>
  <span class="token punctuation">}</span><span class="token plain-text">,
})

export const </span><span class="token punctuation">{</span> increment <span class="token punctuation">}</span><span class="token plain-text"> = dolphins.actions

// 另一种异步 action 的写法，与 createAsyncThunk 不同的是：这里不再是单纯的用来获取异步数据，里面还需要手动 dispatch 同步 actions，是一种命令式的思维，而不是声明式的。不建议使用这种会导致程序难以阅读
export function incrementAsync(num: number): RootThunk </span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token comment">// 可以拿到全局 state 任用</span>
    <span class="token keyword">const</span> rootState <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`TTT: functionincrementAsync -&gt; rootState`</span></span><span class="token punctuation">,</span> rootState<span class="token punctuation">)</span>

    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 触发其他切片的 actions</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span>sharks<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token plain-text">

export default dolphins.reducer
</span></code></pre></div><p>在 FC 组件中使用</p> <p>src/App.tsx</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState<span class="token punctuation">,</span> useAppDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> incrementAsync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/store/dolphins'</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'src/pages/Counter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 全局 state 任取，并且有类型提示</span>
  <span class="token keyword">const</span> storeState <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">:</span> RootState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">)</span>

  <span class="token comment">// dispatch 任何 actions，并且有类型提示（参数里可以进行选择 actionCreater）</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useAppDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> sharks: </span><span class="token punctuation">{</span>storeState<span class="token punctuation">.</span>sharks<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> dolphins: </span><span class="token punctuation">{</span>storeState<span class="token punctuation">.</span>dolphins<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">incrementAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">(async) dolphins、sharks +1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReApp
</code></pre></div><p>在 class 组件中使用</p> <p>src/page/Counter</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect<span class="token punctuation">,</span> ConnectedProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RootState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> incrementAsync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'src/store/sharks'</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">:</span> RootState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  sharks<span class="token punctuation">:</span> state<span class="token punctuation">.</span>sharks<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> mapDispatch <span class="token operator">=</span> <span class="token punctuation">{</span>
  increment<span class="token punctuation">,</span>
  incrementAsync<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> connector <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapState<span class="token punctuation">,</span> mapDispatch<span class="token punctuation">)</span>

<span class="token comment">// 使用 ConnectedProps 推导注入的 props 类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token keyword">extends</span> <span class="token class-name">ConnectedProps</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeof</span> <span class="token attr-name">connector</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain-text">

class ReCounter extends React.Component</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Props</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> sharks<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> incrementAsync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">sharks:</span><span class="token punctuation">{</span>sharks<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">sharks +2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">incrementAsync</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">(async) dolphins、sharks +4</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token plain-text">

export default connector(ReCounter)
</span></code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.da05fdbf.js" defer></script><script src="/assets/js/2.208295da.js" defer></script><script src="/assets/js/25.eda3379a.js" defer></script><script src="/assets/js/5.b3cdef39.js" defer></script>
  </body>
</html>

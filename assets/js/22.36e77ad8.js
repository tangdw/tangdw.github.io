(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{417:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"测试运行器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试运行器","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试运行器")]),t._v(" "),a("p",[t._v("jest https://jestjs.io/zh-Hans/")]),t._v(" "),a("blockquote",[a("p",[t._v("出自 facebook 针对 react 做了优化，cra 已集成")])]),t._v(" "),a("h2",{attrs:{id:"dom-、react-组件-测试库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-、react-组件-测试库","aria-hidden":"true"}},[t._v("#")]),t._v(" dom 、react 组件 测试库")]),t._v(" "),a("p",[a("strong",[t._v("enzyme")]),t._v(" https://enzymejs.github.io/enzyme/\n发布很早流行 dom 测试库\n"),a("code",[t._v("yarn add enzyme jest-enzyme enzyme-adapter-react-16")])]),t._v(" "),a("p",[a("strong",[t._v("testing-library")]),t._v(" https://testing-library.com/docs/intro\n新发布的 dom 测试库\n"),a("code",[t._v("yarn add @testing-library/react @testing-library/jest-dom")])]),t._v(" "),a("p",[t._v("下载量对比：https://www.npmtrends.com/@testing-library/react-vs-enzyme")]),t._v(" "),a("p",[t._v("✔️ testing-library 更活跃，使用简单，有针对的 hooks 的周边 "),a("code",[t._v("@testing-library/react-hooks")])]),t._v(" "),a("blockquote",[a("p",[t._v("当然，两者也可以同时使用")])]),t._v(" "),a("p",[a("code",[t._v("yarn add react-test-renderer")]),t._v(" 快照测试")]),t._v(" "),a("h2",{attrs:{id:"测试开发简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试开发简介","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试开发简介")]),t._v(" "),a("ul",[a("li",[t._v("yarn test 只运行与上次 git 提交不同的文件")]),t._v(" "),a("li",[t._v("命名约定： "),a("strong",[t._v("tests")]),t._v(" 文件夹中带有 .js 后缀的文件，.test.js .spec.js 后缀的文件，放于被测试的文件旁边")]),t._v(" "),a("li",[t._v("不必使用 ts ，因为机会用不到类型，而且 jest 对 ts 支持也不太完善")])]),t._v(" "),a("h3",{attrs:{id:"渲染组件-render"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染组件-render","aria-hidden":"true"}},[t._v("#")]),t._v(" 渲染组件 render("),a("App"),t._v(")")],1),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" render"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" screen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@testing-library/react'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("App "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("'debug',\n'container',\n'baseElement',\n'unmount',\n'rerender',\n'asFragment',")]),t._v(" "),a("h3",{attrs:{id:"选择元素-返回-dom-元素"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择元素-返回-dom-元素","aria-hidden":"true"}},[t._v("#")]),t._v(" 选择元素（返回 DOM 元素）")]),t._v(" "),a("p",[t._v("getByRole 可查询所有元素\ngetByLabelText 查找表单\ngetByPlaceholderText 查找 Placeholder\ngetByDisplayValue 表单元素的当前值\ngetByText 除表单外的其他元素\ngetByTestId 没有其他办法就用这个查找\ngetByTitle\ngetByAltText")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("getBy 查找不存在的元素时，会引发错误。而 queryBy 不会，用于否定判断。\nfindBy 用于异步渲染组件测试，返回 promise，await 等待界面最终呈现，用于异步渲染测试")]),t._v(" "),a("p",[t._v("总结：对于任何尚未存在但最终会存在的元素，请使用 findBy 而不是 getBy 或 queryBy。如果为缺少的元素断言，请使用 queryBy。否则默认为 getBy")])]),t._v(" "),a("li",[a("p",[t._v("查找多个元素\ngetAllBy\nqueryAllBy\nfindAllBy")])])]),t._v(" "),a("h3",{attrs:{id:"断言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#断言","aria-hidden":"true"}},[t._v("#")]),t._v(" 断言")]),t._v(" "),a("p",[a("code",[t._v("interface Matchers<R, T = {}>")]),t._v(" 参阅该接口下的方法")]),t._v(" "),a("h3",{attrs:{id:"触发事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发事件","aria-hidden":"true"}},[t._v("#")]),t._v(" 触发事件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 建立在 fireEvent 之上，更能模仿实际用户在浏览器上的行为")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" userEvent "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@testing-library/user-event'")]),t._v("\nuserEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("screen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getByText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请求触发'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"回调函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回调函数","aria-hidden":"true"}},[t._v("#")]),t._v(" 回调函数")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" onChange "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("onChange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toHaveBeenCalledTimes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟函数被调用的次数")]),t._v("\n")])])]),a("h3",{attrs:{id:"异步请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 异步请求")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("jest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'axios'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 确保已对请求库进行模拟")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模拟网络请求响应")]),t._v("\naxios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mockImplementationOnce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stories "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"快照测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快照测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 快照测试")]),t._v(" "),a("p",[a("code",[t._v("yarn add react-test-renderer")]),t._v(" 首次执行会生成一个 html 快照存在本地，下次执行测试时，会与本地快照进行对比，如有变化则测试失败")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" renderer "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react-test-renderer'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'快照测试'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" component "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tree "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" component"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toMatchSnapshot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"自定义的-hooks-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义的-hooks-测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 自定义的 hooks 测试")]),t._v(" "),a("p",[t._v("因为 hooks 必须在函数组件内使用，而 "),a("code",[t._v("@testing-library/react-hooks")]),t._v(" 提供了在真实组件内使用 hooks 的测试体验，从而可以独立对 hooks 进行测试")]),t._v(" "),a("p",[t._v("例子：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" renderHook "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@testing-library/react-hooks'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'测试 hooks'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cb "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderHook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useBeforeMount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBeCalledTimes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])},[],!1,null,null,null);s.default=e.exports}}]);